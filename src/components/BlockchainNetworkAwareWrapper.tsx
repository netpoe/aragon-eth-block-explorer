import { Box, Typography } from "@material-ui/core";
import React from "react";
import { enableEthereumWallet, getWeb3InstanceByNetworkIDAsync } from "../web3";

export const BlockchainNetworkAwareWrapper: React.FC = ({
  children,
}: {
  children?: React.ReactNode;
}) => {
  const [isLoading, setIsLoading] = React.useState(true);
  const [error, setError] = React.useState(null);

  React.useEffect(() => {
    loadWeb3();
  }, []);

  const loadWeb3 = async () => {
    try {
      await getWeb3InstanceByNetworkIDAsync();
      await enableEthereumWallet();
      setIsLoading(false);
    } catch (error) {
      console.error(error);
      setError(error);
    }
  };

  return (
    <>
      {Boolean(error) ? (
        <Typography>Error</Typography>
      ) : isLoading ? (
        <Box
          height="100vh"
          display="flex"
          justifyContent="center"
          flexDirection="column"
          textAlign="center"
          alignItems="center"
        >
          <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTM2IiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEzNiAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0xMjIuODEzIDQxLjE1NjFDMTIyLjQ4NSA0MC40NTIgMTIxLjc3OSA0MC4wMDAyIDEyMS4wMDEgNDAuMDAwMkg5Ny4zMDA4TDEyMC42OTEgMy4wNzAwOEMxMjEuMDgxIDIuNDU0MTUgMTIxLjEwNSAxLjY3NDE0IDEyMC43NTMgMS4wMzYxN0MxMjAuNDAxIDAuMzk2MDk1IDExOS43MjkgMCAxMTkuMDAxIDBIODcuMDAwOEM4Ni4yNDI4IDAgODUuNTUwNyAwLjQyNzk3IDg1LjIxMDggMS4xMDYwMkw1NS4yMTA5IDYxLjEwNjFDNTQuOTAwOCA2MS43MjQyIDU0LjkzNDggNjIuNDYwMSA1NS4yOTg4IDYzLjA1QzU1LjY2NDkgNjMuNjQgNTYuMzA2OCA2NCA1Ny4wMDA4IDY0SDc3LjU2NjdMNTUuMTU2OCAxMTcuMjI0QzU0Ljc3NDcgMTE4LjEzNCA1NS4xMTQ4IDExOS4xOSA1NS45NTY3IDExOS43MDZDNTYuMjgwNiAxMTkuOTA0IDU2LjY0MDYgMTIwIDU2Ljk5ODcgMTIwQzU3LjU3MjcgMTIwIDU4LjEzODcgMTE5Ljc1NCA1OC41MzA4IDExOS4yOUwxMjIuNTMxIDQzLjI4OTlDMTIzLjAzMyA0Mi42OTQxIDEyMy4xNDEgNDEuODYyIDEyMi44MTMgNDEuMTU2MVoiIGZpbGw9InVybCgjcGFpbnQwX2xpbmVhcikiLz4KPHBhdGggZD0iTTExMy44MTMgNDEuMTU2MUMxMTMuNDg1IDQwLjQ1MiAxMTIuNzc5IDQwLjAwMDIgMTEyLjAwMSA0MC4wMDAySDg4LjMwMDhMMTExLjY5MSAzLjA3MDA4QzExMi4wODEgMi40NTQxNSAxMTIuMTA1IDEuNjc0MTQgMTExLjc1MyAxLjAzNjE3QzExMS40MDEgMC4zOTYwOTUgMTEwLjcyOSAwIDExMC4wMDEgMEg3OC4wMDA4Qzc3LjI0MjggMCA3Ni41NTA3IDAuNDI3OTcgNzYuMjEwOCAxLjEwNjAyTDQ2LjIxMDkgNjEuMTA2MUM0NS45MDA4IDYxLjcyNDIgNDUuOTM0OCA2Mi40NjAxIDQ2LjI5ODggNjMuMDVDNDYuNjY0OSA2My42NCA0Ny4zMDY4IDY0IDQ4LjAwMDggNjRINjguNTY2N0w0Ni4xNTY4IDExNy4yMjRDNDUuNzc0NyAxMTguMTM0IDQ2LjExNDggMTE5LjE5IDQ2Ljk1NjcgMTE5LjcwNkM0Ny4yODA2IDExOS45MDQgNDcuNjQwNiAxMjAgNDcuOTk4NyAxMjBDNDguNTcyNyAxMjAgNDkuMTM4NyAxMTkuNzU0IDQ5LjUzMDggMTE5LjI5TDExMy41MzEgNDMuMjg5OUMxMTQuMDMzIDQyLjY5NDEgMTE0LjE0MSA0MS44NjIgMTEzLjgxMyA0MS4xNTYxWiIgZmlsbD0idXJsKCNwYWludDFfbGluZWFyKSIvPgo8cGF0aCBkPSJNMTIyIDQwQzEyOS4xOCA0MCAxMzUgMzQuMTc5NyAxMzUgMjdDMTM1IDE5LjgyMDMgMTI5LjE4IDE0IDEyMiAxNEMxMTQuODIgMTQgMTA5IDE5LjgyMDMgMTA5IDI3QzEwOSAzNC4xNzk3IDExNC44MiA0MCAxMjIgNDBaIiBzdHJva2U9InVybCgjcGFpbnQyX2xpbmVhcikiIHN0cm9rZS13aWR0aD0iMC44IiBzdHJva2UtZGFzaGFycmF5PSIxIi8+CjxwYXRoIGQ9Ik0yOSAxMTNDNDQuNDY0IDExMyA1NyAxMDAuNDY0IDU3IDg1QzU3IDY5LjUzNiA0NC40NjQgNTcgMjkgNTdDMTMuNTM2IDU3IDEgNjkuNTM2IDEgODVDMSAxMDAuNDY0IDEzLjUzNiAxMTMgMjkgMTEzWiIgc3Ryb2tlPSJ1cmwoI3BhaW50M19saW5lYXIpIiBzdHJva2Utd2lkdGg9IjAuOCIgc3Ryb2tlLWRhc2hhcnJheT0iMSIvPgo8ZGVmcz4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDBfbGluZWFyIiB4MT0iODkiIHkxPSIwIiB4Mj0iODkiIHkyPSIxMjAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iI0RBRjNGOCIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNDREYwRjgiIHN0b3Atb3BhY2l0eT0iMC40NyIvPgo8L2xpbmVhckdyYWRpZW50Pgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MV9saW5lYXIiIHgxPSIzMi44NTcxIiB5MT0iMTA0LjI4NiIgeDI9IjE3Mi4xMjciIHkyPSItNTkuOTQ4MiIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgo8c3RvcCBzdG9wLWNvbG9yPSIjOUNFMkYxIi8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzQ0QzlFNiIvPgo8L2xpbmVhckdyYWRpZW50Pgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50Ml9saW5lYXIiIHgxPSIxMTcuMjc4IiB5MT0iOS41MzQyNCIgeDI9IjEwOC4zNDciIHkyPSIzNi44NDExIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIHN0b3AtY29sb3I9IiM1QkNGRTgiIHN0b3Atb3BhY2l0eT0iMC4wMSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiMyQ0IyRTEiLz4KPC9saW5lYXJHcmFkaWVudD4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDNfbGluZWFyIiB4MT0iNjYuNSIgeTE9IjM1LjUiIHgyPSItMC40MDczOTgiIHkyPSIxMDYuMTk2IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIHN0b3AtY29sb3I9IiM1QkNGRTgiIHN0b3Atb3BhY2l0eT0iMC4wMSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiMyQ0IyRTEiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K" />
        </Box>
      ) : (
        <>{children}</>
      )}
    </>
  );
};
